<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>行程列表</title>
<meta
	content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no'
	name='viewport'>
<!-- css-page-preload-animations -->
<link href="${contextPath}/assets/thirdParty/pagePreloadAnimations/css/Icomoon/style.css"
	rel="stylesheet" type="text/css" />
<link href="${contextPath}/assets/thirdParty/pagePreloadAnimations/css/main.css"
	rel="stylesheet" type="text/css" />
<!-- css-page-preload-animations -->
<!-- Theme style -->
<link href="${contextPath}/assets/css/AdminLTE/AdminLTE.css"
	rel="stylesheet" type="text/css" />
<link href="${contextPath}/assets/css/AdminLTE/skins/skin-blue.min.css"
	rel="stylesheet" type="text/css" />
<!-- Bootstrap 3.3.4 -->
<link
	href="${contextPath}/assets/thirdParty/bootstrap/bootstrap-3.3.5/css/bootstrap.min.css"
	rel="stylesheet" type="text/css" />
<link href="${contextPath}/assets/thirdParty/jqgrid/ui.jqgrid-bootstrap.css" rel="stylesheet" type="text/css" />
<!-- model -->
<!--  <link
	href="${contextPath}/assets/thirdParty/bootstrap/extend/modal/css/bootstrap-responsive.min.css"
	rel="stylesheet" type="text/css" />-->
<!-- Font Awesome Icons -->
<link href="${contextPath}/assets/css/font-awesome.min.css"
	rel="stylesheet" type="text/css" />
<!-- Ionicons -->
<link href="${contextPath}/assets/css/ionicons.min.css" rel="stylesheet"
	type="text/css" />
<#include "../public/common/ieSupport.html"> 
<#include "../public/common/loadingStyle.html"> 
</head>
<body class="skin-blue fixed" data-spy="scroll" data-target="#scrollspy"> 
    <#include "../public/common/loadingHtml.html"> 
	<!--  -->
	<div class="wrapper" id="wrapperContext" name="wrapperContext">
		<!-- page header start -->
		<header class="main-header">
			<!-- Logo -->
			<#include "../public/common/logo.html"> 
			<!-- Logo -->
			<#include "../public/common/headerNavbar.html">
		</header>
		<!-- page header end -->
		<!-- Left side column. contains the logo and sidebar -->
		<aside class="main-sidebar">
			<!-- sidebar: style can be found in sidebar.less -->
			<div class="sidebar" id="scrollspy">
				<!-- sidebar menu: : style can be found in sidebar.less -->
				<ul class="nav sidebar-menu">
					<li class="header"></li>
					<!-- menu items start -->
					<#include "../public/common/publicNav.html">
					<!-- menu items end -->
				</ul>
			</div>
			
			<!-- /.sidebar -->
		</aside>

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- Content Header (Page header) -->
			<div class="content-header">
				<h1>
					设备信息详情
				</h1>
				<ol class="breadcrumb">
					<li><a href="${contextPath}/analysisadmin/analysis/index.html"><i class="fa fa-dashboard"></i> 首页</a></li>
					<li class="active">场站信息管理页面</li>
				</ol>
			</div>
			    <!--
				<div class="callout myself-callout-info">
		                <div class='col-md-4'>
				       		<label for="dtp_input3" class="col-md-3 control-label ">开始</label>
				            <div class='input-group date col-md-9' id='datetimepicker1'>
			                    <input type='text' class="form-control" readonly/>
			                    <span class="input-group-addon">
			                        <span class="glyphicon glyphicon-calendar"></span>
			                    </span>
			                </div>
		                	<input type="hidden" id="dtp_input3" value="" />
				        </div>
				        <div class='col-md-4'>
				       		<label for="dtp_input3" class="col-md-3 control-label ">结束</label>
				            <div class='input-group date col-md-9' id='datetimepicker1'>
			                    <input type='text' class="form-control" readonly/>
			                    <span class="input-group-addon">
			                        <span class="glyphicon glyphicon-calendar"></span>
			                    </span>
			                </div>
		                	<input type="hidden" id="dtp_input3" value="" />
				        </div>
				        <div class='col-md-2'>
				            <button class="btn btn-sm bg-olive travelCarSelectShowButton myself-button-margin" id="historicalJourney" name="historicalJourney">查询</button>
				        </div>
				</div>-->
		
			<!-- Main content -->
			<div class="content body myself-padding-buttom" id="mainContent" name="mainContent">
			   <div class="box">
				  <div class="box-header"  style="padding: 0;border-left: 1px solid #ddd;border-right: 1px solid #ddd;background-color: #ededed;">
                            <p class="myself-buttongroup-p-margin">
		                    <button class="btn bg-gray-active btn-xs  myself-button-margin myself-btn-color" id="showTravelVehicle" name="showTravelVehicle">展示车辆行程路线</button>
		                    <button class="btn bg-gray-active btn-xs  myself-button-margin myself-btn-color" id="excelTravelVehicle" name="excelTravelVehicle">导出excel</button>
		                    
					        </p>
					</div>
					<!-- page main content start -->
					<!-- carinfo table -->
					<div class="widget-body" style="padding: 0; padding-top:0px">
						<div id="divContainer" class="container collapse in"
							style="margin: 0">
						</div>
						<div class="widget" id="gridTableContext" name="gridTableContext" style="width:100%;">
							<table id="gridTableTravelCarSelectShow"></table>
							<div id="gridPagerTravelCarSelectShow"></div>
						</div>
					</div>
				</div>
			<!-- carinfo table -->
			<!--  -->
			<!--  -->
			<!-- page main content stop -->
			</div>
			<!-- /.content -->
		</div>
		</div>
		<!-- /.content-wrapper -->
		<#include "../public/common/footer.html"> 
	<!-- ./wrapper -->

	<!-- jQuery 2.1.4 -->
	<script
		src="${contextPath}/assets/thirdParty/js/jquery/resources/jQuery-2.1.4.min.js"></script>
	<script
		src="${contextPath}/assets/thirdParty/json/jquery.json.js"></script>
	<!-- Bootstrap 3.3.5 JS -->
	<script
		src="${contextPath}/assets/thirdParty/bootstrap/bootstrap-3.3.5/js/bootstrap.min.js"
		type="text/javascript"></script>
	<!-- mode -->
	<!-- FastClick -->
	<script
		src='${contextPath}/assets/thirdParty/js/jquery/plugins/fastclick/fastclick.min.js'></script>
	<!-- AdminLTE App -->
	<script src="${contextPath}/assets/thirdParty/js/app.js"
		type="text/javascript"></script>
	<!-- SlimScroll 1.3.0 -->
	<script
		src="${contextPath}/assets/thirdParty/js/jquery/plugins/slimScroll/jquery.slimscroll.min.js"
		type="text/javascript"></script>
    <#include "../public/common/baiduMap.html"> 
	<script type="text/javascript" src="http://api.map.baidu.com/library/LuShu/1.2/src/LuShu_min.js"></script>
	<!-- jqgrid start-->
	<#include "../public/common/jqgridRelyOnJs.html"> 
	<!-- jqgrid end-->
	<#include "../public/common/layerSource.html"> 
	<!-- bootbox -->
	<script src="${contextPath}/assets/thirdParty/bootbox/bootbox.js"></script>
	<!-- bootbox -->
	<!-- 公用方法 -->
    <script type="text/javascript" src="${contextPath}/assets/thirdParty/public/publicMethod.js"></script>
    <script type="text/javascript" src="${contextPath}/assets/thirdParty/public/calculateScreenSize.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	bindingEvents();
	var leftWidth=parseInt($('#gridTableContext').css('borderLeftWidth'));
	var rightWidth=parseInt($('#gridTableContext').css('borderRightWidth'));
	var tableWidth=_getElementWidthA("#gridTableContext")-leftWidth-rightWidth-2;
	
	structureTravelCarSelectShowTable(tableWidth,500);
	$('#wrapperContext').css("height",_getElementHeightC(".content-wrapper")+20);
    $('.content-wrapper').css('min-height','100%');
});
$(function(){
   $("#loading").delay(2000).fadeOut(500);
   _selfgridComplete();
});
/**
* 表格数据加载完成执行
*/
function _selfgridComplete(){
    console.log("_selfgridComplete $('body').scrollTop()="+$("body").scrollTop());
    //查看是否存在滚动条
    $("body").scrollTop(10);//控制滚动条下移10px  
    if( $("body").scrollTop()>0 ){  
        //如果有滚动条
        var leftWidth=parseInt($('.widget').css('borderLeftWidth'));
		var rightWidth=parseInt($('.widget').css('borderRightWidth'));
		var paddingRight=parseInt($("#mainContent").css('padding-right'));
		var tableWidth=_getElementWidthA(".widget")-leftWidth-rightWidth;
 	    $("#gbox_gridTableTravelCarSelectShow").width(tableWidth);
 	    $("#gview_gridTableTravelCarSelectShow").width(tableWidth);
		$("#gridPagerTravelCarSelectShow").width(tableWidth);
 	}else{  
        //如果没有滚动条
    } 
    $("body").scrollTop(0);//滚动条返回顶部  
}
//加载表格数据start
<#include "../public/common/workTravelCarSelectShowTable.html"> 
//加载表格数据end
function bindingEvents(){
    //查看车辆实时位置
    $("#showTravelVehicle").unbind('click').click(function(){
	    handleShowTravelVehicle();
	});
	$("#excelTravelVehicle").unbind('click').click(function(){
	    handleExcelTravelVehicle();
	});
}
function handleExcelTravelVehicle(){
    var obj = $("#gridTableTravelCarSelectShow").jqGrid(
							'getGridParam', 'userData');
	if (obj.sql) {
		var url="${contextPath}/analysisadmin/analysis/exporting/excel.html?exportSql="+obj.sql;
        window.open(url);
	}
   
}
//处理车辆实时位置信息
function handleShowTravelVehicle(){
    _obtainTableSelRowData(controlForShowTravelVehicle);
} 
function controlForShowTravelVehicle(data){
    //弹框调用在百度地图上展示车辆的实时位置
    var operId=data.operId;
    var carId=data.carId;
    var deviceId=data.deviceId;
    if(publicJudgmentObject(operId)==true&&publicJudgmentObject(carId)==true&&publicJudgmentObject(deviceId)==true){
	    var queryAreadyAssignedAgencyUrl="${contextPath}/analysisadmin/analysis/travelShow/travelCarSelectShow.html?operId="+operId+"&carId="+carId+"&deviceId="+deviceId;
	    openRealTimePositionWindow("车辆运行轨迹",queryAreadyAssignedAgencyUrl);
    }
}
//弹出百度地图
function openRealTimePositionWindow(loadWindowTitle,urlOfRealTimeMonitoring){
    var _winWidth=_screenSizefunctionA()*0.9+"px";
    var _winHeight=_screenSizefunctionC()*0.9+"px";
	layer.open({
        type: 2,
        title: loadWindowTitle,
        fix: false,
        shadeClose: true,
        //maxmin: true,
        area: [_winWidth, _winHeight],
	    content: urlOfRealTimeMonitoring //这里content是一个DOM
    });
}
//点击表格中的某一行后显示出显示出当前车辆的实时位置
function _selectedVehicle(rowId){
    console.log(rowId);
    //获取这一行的数据
	 _obtainTableSelRowData(controlForShowTravelVehicle);
	//
	
}
function _obtainTableSelRowData(_controlFunc){
    var rowData=obtainDataGridSelectRowData("gridTableTravelCarSelectShow");
	//判断是否有选中行如果没有选中行就报错提示
	if(publicJudgmentObject(rowData)==true){
		//如果有选中的行就调用回掉函数
		_controlFunc(rowData);
	}else{
	    //弹出请先选中行
	    layer.msg('请先选择要查看的车辆');
	}
}
</script>
</body>
</html>
  
